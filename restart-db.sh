#!/bin/bash

echo "ğŸ”„ é‡æ–°å¯åŠ¨æ•°æ®åº“ä»¥åº”ç”¨æ–°çš„è¡¨ç»“æ„..."

# åœæ­¢å¹¶åˆ é™¤æ•°æ®åº“å®¹å™¨
echo "ğŸ“¤ åœæ­¢ç°æœ‰çš„æ•°æ®åº“å®¹å™¨..."
docker-compose stop db
docker-compose rm -f db

# åˆ é™¤æ•°æ®åº“æ•°æ®å·ï¼ˆå¯é€‰ï¼Œå¦‚æœä½ æƒ³ä¿ç•™ç°æœ‰æ•°æ®è¯·æ³¨é‡Šæ‰ä¸‹é¢è¿™è¡Œï¼‰
echo "ğŸ—‘ï¸  åˆ é™¤æ•°æ®åº“æ•°æ®å·ï¼ˆè¿™å°†æ¸…é™¤æ‰€æœ‰ç°æœ‰æ•°æ®ï¼‰..."
docker volume rm test-app_postgres_data 2>/dev/null || true

# é‡æ–°å¯åŠ¨æ•°æ®åº“
echo "ğŸš€ é‡æ–°å¯åŠ¨æ•°æ®åº“..."
docker-compose up -d db

# ç­‰å¾…æ•°æ®åº“å¯åŠ¨
echo "â³ ç­‰å¾…æ•°æ®åº“å¯åŠ¨..."
sleep 10

# æ£€æŸ¥æ•°æ®åº“çŠ¶æ€
echo "âœ… æ£€æŸ¥æ•°æ®åº“çŠ¶æ€..."
docker-compose ps db

echo "ğŸ‰ æ•°æ®åº“é‡å¯å®Œæˆï¼æ–°çš„client_accountsè¡¨å·²åˆ›å»ºã€‚"
echo "ğŸ’¡ ç°åœ¨å¯ä»¥é‡æ–°å¯åŠ¨åç«¯æœåŠ¡ï¼š"
echo "   docker-compose restart backend" 